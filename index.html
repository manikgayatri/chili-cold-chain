<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Alert Cabai – Before vs After Web Cloud</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <div class="badge">
          <span class="badge-dot"></span>
          Monitoring Chili Cold Chain – Real-time Alert
        </div>
        <h1>Web Cloud Alert untuk Menurunkan Reject Cabai</h1>
        <p>
          Simulasi bagaimana sistem alert berbasis web &amp; cloud membantu menurunkan
          reject cabai minimal <strong>30%</strong> dengan membandingkan data
          <strong>Before</strong> dan <strong>After</strong>.
        </p>
      </div>

      <div class="controls">
        <div class="controls-group">
          <label>Baseline reject dari data Before (%)</label>
          <input
            type="number"
            id="baselineRejectInput"
            min="1"
            max="100"
            step="0.1"
          />
        </div>
        <div class="controls-group">
          <label>Batas cacat maksimal (%)</label>
          <input
            type="number"
            id="defectThresholdInput"
            min="1"
            max="100"
            step="0.1"
            value="20"
          />
        </div>
        <button class="btn btn-outline" id="updateConfigBtn">
          <span class="btn-icon">⚙️</span>
          Terapkan Pengaturan
        </button>
        <button class="btn btn-primary" id="toggleSimulationBtn">
          <span class="btn-icon">▶</span>
          Jalankan Simulasi Data
        </button>
      </div>
    </header>

    <main>
      <!-- KIRI: METRICS & TABEL -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              Bukti Pengurangan Reject – Before vs After
            </div>
            <div class="card-subtitle">
              Diambil dari sheet <strong>Reject_KPI</strong> (ETL/Power BI kamu).
            </div>
          </div>
        </div>

        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-label">
              <span>Baseline Reject (Before)</span>
              <span class="metric-badge" id="baselineBadge">Auto dari data</span>
            </div>
            <div class="metric-value">
              <span id="baselineRejectText">0</span><span>%</span>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-label">
              <span>Reject Saat Ini (After)</span>
              <span
                class="metric-badge metric-badge--bad"
                id="currentRejectBadge"
              >
                Tinggi
              </span>
            </div>
            <div class="metric-value">
              <span id="currentRejectText">0</span><span>%</span>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-label">
              <span>Penurunan Reject</span>
              <span
                class="metric-badge metric-badge--good"
                id="reductionBadge"
              >
                Target ≥ 30%
              </span>
            </div>
            <div class="metric-value">
              <span id="reductionText">0</span><span>%</span>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-label">
              <span>Total Batch Terpantau</span>
              <span class="metric-badge" id="rejectCountBadge">0 Reject</span>
            </div>
            <div class="metric-value">
              <span id="totalBatchText">0</span>
            </div>
          </div>
        </div>

        <div class="progress-wrapper">
          <div class="progress-header">
            <span>Progres Pencapaian Target Pengurangan 30%</span>
            <span id="progressText">0% dari target</span>
          </div>
          <div class="progress-bar">
            <div class="progress" id="progressBar"></div>
          </div>
          <div class="progress-marker">
            <div class="progress-marker-line" style="left: 100%"></div>
            <div class="progress-marker-label" style="left: 100%">
              Target 30%
            </div>
          </div>
          <div class="status-text" id="statusText">
            <span class="status-pill neutral"></span>
            <span>
              Menunggu simulasi dijalankan untuk menilai dampak pengurangan reject...
            </span>
          </div>
        </div>

        <div class="thresholds" id="thresholdInfo">
          <span>
            Ambang cacat saat ini:
            <strong id="thresholdDefectText">20%</strong>
          </span>
          <span>
            Peringatan dini jika cacat &ge;
            <strong id="thresholdEarlyText">16%</strong>
          </span>
        </div>

        <div class="data-table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Batch</th>
                <th>Waktu</th>
                <th>Truck</th>
                <th>Suhu (°C)</th>
                <th>Cacat (%)</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="batchTableBody">
              <!-- Diisi dari JS berdasarkan sheet Condition -->
            </tbody>
          </table>
        </div>

        <p class="note">
          <strong>Cara baca:</strong> baseline dan after diambil dari sheet
          <strong>Reject_KPI</strong> (kolom
          <code>reject_before</code>, <code>reject_after</code>,
          <code>reject_reduction</code>, <code>Reject_Target</code>).
          Alert real-time didasarkan pada sheet <strong>Condition</strong>
          (kolom suhu, visual, dll) dan <strong>Alert</strong>.
        </p>
      </section>

      <!-- KANAN: ALERT -->
      <section class="card">
        <!-- ⭐⭐ FORM INPUT MANUAL BATCH ⭐⭐ -->
        <div class="card-header">
          <div>
            <div class="card-title">Input Batch Manual</div>
            <div class="card-subtitle">
              Petani / petugas bisa mengisi data batch langsung di sini.
            </div>
          </div>
        </div>

        <form id="manualBatchForm" class="manual-form">
          <div class="manual-row">
            <div class="manual-group">
              <label for="manualBatchId">ID Batch</label>
              <input
                type="text"
                id="manualBatchId"
                placeholder="mis. BATCH_5"
                required
              />
            </div>
            <div class="manual-group">
              <label for="manualTruckId">ID Truck</label>
              <input
                type="text"
                id="manualTruckId"
                placeholder="mis. TRUCK_1"
                required
              />
            </div>
          </div>

          <div class="manual-row">
            <div class="manual-group">
              <label for="manualTemp">Suhu (°C)</label>
              <input
                type="number"
                step="0.1"
                id="manualTemp"
                placeholder="mis. 18.5"
                required
              />
            </div>
            <div class="manual-group">
              <label for="manualDefect">Cacat / Susut bobot (%)</label>
              <input
                type="number"
                step="0.1"
                id="manualDefect"
                placeholder="mis. 3.5"
                required
              />
            </div>
          </div>

          <div class="manual-row">
            <button type="submit" class="btn btn-primary">
              ➕ Tambah Batch
            </button>
            <span class="manual-hint">
              Waktu otomatis pakai jam saat ini.
            </span>
          </div>
        </form>
      </section>

        <div class="card-header">
          <div>
            <div class="card-title">Peringatan Real-time</div>
            <div class="card-subtitle">
              Contoh notifikasi yang akan diterima petani/gudang jika kualitas
              cabai bermasalah.
            </div>
          </div>
          <span class="pill-soft" id="alertCounter">0 alert</span>
        </div>

        <div class="alert-list" id="alertList">
          <div class="alert-empty">
            Belum ada peringatan. Klik <strong>“Jalankan Simulasi Data”</strong>
            untuk memutar data dari sheet <strong>Condition</strong>.
          </div>
        </div>

        <p class="note">
          Notifikasi ini di dunia nyata bisa dikirim ke
          <strong>HP petani, WA grup, dashboard gudang, atau aplikasi pasar</strong>,
          sehingga masyarakat di rantai pasok cabai bisa mengambil aksi dini
          sebelum reject makin besar.
        </p>
      </section>
    </main>
  </div>

  <script src="app.js"></script>
</body>
</html>